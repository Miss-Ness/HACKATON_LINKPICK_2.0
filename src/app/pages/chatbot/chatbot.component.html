<section class="section">
    <div class="container">
        <!-- Sidebar historique (permanente √† gauche) -->
        <div class="history-sidebar glass">
            <div class="history-header">
                <h3>üí¨ Conversations</h3>
                <button mat-raised-button class="new-chat-btn" (click)="reset()">
                    Nouveau chat
                </button>
            </div>

            <div class="history-list">
                <div *ngFor="let conv of conversations" 
                     class="history-item"
                     [class.active]="conv.id === currentConversationId"
                     (click)="loadConversation(conv.id)">
                    <div class="history-content">
                        <div class="history-title">{{ conv.title }}</div>
                        <div class="history-date muted">{{ conv.createdAt | date:'dd/MM HH:mm' }}</div>
                    </div>
                    <button mat-icon-button class="delete-btn" (click)="deleteConversation(conv.id, $event)">
                        <mat-icon>üóëÔ∏è</mat-icon>
                    </button>
                </div>

                <div *ngIf="conversations.length === 0" class="empty-state">
                    Aucune conversation.<br>Cr√©ez-en une pour commencer !
                </div>
            </div>
        </div>

        <!-- Zone principale -->
        <div class="main-content">

            <!-- Chat -->
            <div class="chat glass">
                <div class="chat-body" #scrollEl>
                    <div *ngFor="let m of messages" class="msg" [class.user]="m.role==='user'" [class.bot]="m.role==='bot'">
                        <div class="bubble">
                            <pre>{{ m.text }}</pre>
                        </div>
                    </div>
                    <div class="typing" *ngIf="isTyping">
                        <div class="dot"></div><div class="dot"></div><div class="dot"></div>
                        <span class="muted">Le bot r√©fl√©chit‚Ä¶</span>
                    </div>
                </div>
                
                <div class="chat-input">
                    <button mat-icon-button (click)="triggerUpload()" matTooltip="Uploader un CV">
                        <mat-icon>üìé</mat-icon>
                    </button>
                    
                    <mat-form-field appearance="fill" class="field">
                        <textarea
                            matInput
                            [(ngModel)]="input"
                            (keydown)="onKeyDown($event)"
                            rows="2"
                            placeholder="√âcris ton message ici..."></textarea>
                    </mat-form-field>
                    
                    <button mat-raised-button class="send" (click)="send()" [disabled]="!input.trim() || isTyping">
                        Envoyer
                    </button>
                    <input #fileInput type="file" hidden (change)="onFileSelected($event)" accept=".pdf,.doc,.docx" />
                </div>
                
                <div class="chat-footer">
                    <div class="quick">
                        <button *ngFor="let q of quickReplies" mat-stroked-button class="pill small" (click)="send(q)">
                            {{ q }}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>